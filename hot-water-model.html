<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Hot Water Model â€” Preset Sliders</title>
<style>
  :root{--fg:#111;--bg:#fff;--muted:#666;--b:#e5e7eb;--pri:#0b84ff}
  *{box-sizing:border-box}
  body{margin:0;font:15px/1.45 -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Ubuntu;color:var(--fg);background:var(--bg)}
  header{padding:14px 16px;border-bottom:1px solid var(--b);display:flex;align-items:center;gap:10px;flex-wrap:wrap}
  h1{font-size:16px;margin:0}
  .wrap{max-width:940px;margin:0 auto;padding:16px}
  .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
  @media (max-width:920px){.grid{grid-template-columns:repeat(2,1fr)}}
  @media (max-width:560px){.grid{grid-template-columns:1fr}}
  label{font-weight:600;font-size:12px;color:var(--muted);display:block;margin:0 0 6px}
  select,input[type="number"],input[type="range"]{width:100%}
  input[type="number"],select{padding:8px 10px;border:1px solid var(--b);border-radius:8px;background:#fff}
  .row{margin:10px 0 4px}
  .card{border:1px solid var(--b);border-radius:12px;padding:14px}
  .card h2{margin:0 0 8px;font-size:16px}
  .sub{color:var(--muted);font-size:12px;margin-top:-4px}
  .kpi{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin:10px 0}
  @media(max-width:560px){.kpi{grid-template-columns:1fr}}
  .pill{border:1px solid var(--b);border-radius:10px;padding:10px}
  .actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  button{padding:9px 12px;border:1px solid var(--b);background:#fff;border-radius:10px;cursor:pointer}
  button.primary{background:var(--pri);border-color:var(--pri);color:#fff}
  .score{font:600 28px/1.1 system-ui;margin:4px 0}
  .muted{color:var(--muted)}
  .slrow{display:flex;align-items:center;gap:10px}
  .slrow output{min-width:2ch;text-align:right;font-variant-numeric:tabular-nums}
  footer{padding:16px;text-align:center;color:var(--muted);font-size:12px}
</style>
</head>
<body>
<header>
  <h1>Hot Water Model</h1>
  <span class="muted">Physics â€¢ Cost â€¢ Customer-weighted score</span>
</header>

<div class="wrap">
  <div class="card">
    <h2>Inputs</h2>
    <div class="grid">
      <div>
        <label>Usage</label>
        <select id="usage">
          <option>Low (1â€“2 ppl)</option>
          <option selected>Med (3â€“4 ppl)</option>
          <option>High (5â€“6 ppl)</option>
        </select>
      </div>
      <div>
        <label>Season (UK mains temp)</label>
        <select id="mains">
          <option>Winter</option>
          <option selected>Spring/Autumn</option>
          <option>Summer</option>
        </select>
      </div>
      <div>
        <label>Pipe layout (waiting water)</label>
        <select id="layout">
          <option selected>Central</option>
          <option>Typical</option>
          <option>Remote</option>
        </select>
      </div>
      <div>
        <label>System</label>
        <select id="system">
          <option selected>Stored Gold (Worcester+Mixergy)</option>
          <option>Stored Standard</option>
          <option>Combi Standard</option>
          <option>Combi Premium</option>
        </select>
      </div>
    </div>

    <div class="grid" style="margin-top:12px">
      <div>
        <label>Gas price ( Â£ / kWh )</label>
        <input id="gas" type="number" step="0.001" value="0.07">
      </div>
      <div>
        <label>Water price ( Â£ / L )</label>
        <input id="water" type="number" step="0.00001" value="0.0003">
      </div>
    </div>

    <div class="card" style="margin-top:12px">
      <div class="sub">Adjust what matters most to your customer:</div>
      <div class="grid" style="margin-top:8px">
        <div class="slrow"><label style="flex:1">ğŸ”‹ Energy</label><input id="wE" type="range" min="0" max="10" step="1" value="3"><output id="wEVal">3</output></div>
        <div class="slrow"><label style="flex:1">ğŸ’· Cost</label><input id="wCost" type="range" min="0" max="10" step="1" value="5"><output id="wCostVal">5</output></div>
        <div class="slrow"><label style="flex:1">ğŸ› Comfort</label><input id="wC" type="range" min="0" max="10" step="1" value="4"><output id="wCVal">4</output></div>
        <div class="slrow"><label style="flex:1">ğŸŒ± Future-proof</label><input id="wF" type="range" min="0" max="10" step="1" value="4"><output id="wFVal">4</output></div>
        <div class="slrow"><label style="flex:1">ğŸ”§ Maintenance</label><input id="wM" type="range" min="0" max="10" step="1" value="2"><output id="wMVal">2</output></div>
      </div>
      <div class="actions" style="margin-top:10px">
        <button id="presetBudget">ğŸ’° Budget-led</button>
        <button id="presetComfort">ğŸ› Comfort-led</button>
        <button id="presetFuture">ğŸŒ± Future-ready</button>
        <button id="presetReset">â™»ï¸ Reset</button>
      </div>
    </div>
  </div>

  <div class="card" id="results" style="margin-top:16px">
    <h2>Results</h2>
    <div class="kpi">
      <div class="pill"><div class="muted">Energy</div><div><b id="kwhDay">â€”</b> kWh/day</div><small id="kwhYear">â€”</small></div>
      <div class="pill"><div class="muted">Running cost</div><div>Â£<b id="costDay">â€”</b>/day</div><small id="costYear">â€”</small></div>
      <div class="pill"><div class="muted">Waiting water</div><div><b id="wasteL">â€”</b> L/day</div><small>from layout + draws</small></div>
    </div>

    <div class="grid">
      <div class="pill"><div class="muted">Customer score</div><div class="score" id="score">â€”</div><small>Energy <span id="uE">â€”</span> â€¢ Cost <span id="uP">â€”</span> â€¢ Comfort <span id="uC">â€”</span> â€¢ Future <span id="uF">â€”</span> â€¢ Maint <span id="uM">â€”</span></small></div>
      <div class="pill"><div class="muted">Breakdown</div>
        <div>Useful <b id="eUse">â€”</b> kWh/day</div>
        <div>Waiting <b id="eWait">â€”</b> kWh/day</div>
        <div>Standby <b id="standby">â€”</b> kWh/day</div>
        <div>Î· <b id="eta">â€”</b> Starts <b id="starts">â€”</b></div>
      </div>
      <div class="pill"><div class="muted">Selections</div>
        <div id="echo">â€”</div>
        <div class="actions" style="margin-top:8px">
          <button id="copy">Copy JSON</button>
          <button id="link">Share Link</button>
        </div>
      </div>
    </div>
  </div>

  <footer>Â© Hot Water Model â€“ preset sliders build</footer>
</div>

<script type="module">
const CP=0.001163;
const clamp=(v,min,max)=>Math.max(min,Math.min(max,v));
const round=(n,d=2)=>Math.round(n*10**d)/10**d;
const etaFromReturn=t=>t<=30?0.98:t>=55?0.88:0.98-0.004*(t-30);
const invUtility=(val,best)=>clamp(100*(best/val),10,100);
const toNumber=(val,fallback)=>{
  const n=parseFloat(val);
  return Number.isFinite(n)?n:fallback;
};
const toInteger=(val,fallback)=>{
  const n=parseInt(val,10);
  return Number.isFinite(n)?n:fallback;
};

const PRE={
  usage:{
    "Low (1â€“2 ppl)":{Vd:80,dr:12},
    "Med (3â€“4 ppl)":{Vd:130,dr:18},
    "High (5â€“6 ppl)":{Vd:180,dr:24}
  },
  mains:{"Winter":8,"Spring/Autumn":12,"Summer":16},
  layout:{"Central":0.35,"Typical":0.7,"Remote":1.2},
  system:{
    "Stored Gold (Worcester+Mixergy)":{t:"s",sb:1,cf:0.95,Tr:48,C:92,F:95,M:85},
    "Stored Standard":{t:"s",sb:1.4,cf:1,Tr:52,C:88,F:80,M:82},
    "Combi Standard":{t:"c",st:0.01,sc:1.05,Tr:55,C:72,F:50,M:70},
    "Combi Premium":{t:"c",st:0.008,sc:1,Tr:52,C:78,F:55,M:78}
  },
  price:{gas:0.07,water:0.0003},
  weights:{energy:3,cost:5,comfort:4,future:4,maintenance:2},
  Tuse:40
};

function baseCalc({usage,mains,layout,system,price}){
  const U=PRE.usage[usage];
  const M=PRE.mains[mains];
  const L=PRE.layout[layout];
  const S=PRE.system[system];
  const Tu=PRE.Tuse;
  const Tm=M;
  const Eu=U.Vd*CP*(Tu-Tm);
  const Vw=L*U.dr;
  const Ew=Vw*CP*(Tu-Tm);
  const eta=etaFromReturn(S.Tr);
  let E=0, cost=0, standby=0, starts=0;
  if(S.t==="s"){
    const Eg=((Eu+Ew)/eta)*S.cf;
    standby=S.sb||0;
    E=Eg+standby;
    cost=E*price.gas+Vw*price.water;
  }else{
    const etaEff=eta/(S.sc||1);
    starts=U.dr;
    const Eover=starts*(S.st||0.01);
    E=((Eu+Ew)/etaEff)+Eover;
    cost=E*price.gas+Vw*price.water;
  }
  return {
    energy:E,
    cost,
    waitLitres:Vw,
    breakdown:{Eu,Ew,standby,eta,starts}
  };
}

function compute(state){
  const price={gas:state.pgas,water:state.pw};
  const base=baseCalc({usage:state.u,mains:state.m,layout:state.l,system:state.s,price});
  const refGold=baseCalc({usage:state.u,mains:state.m,layout:state.l,system:"Stored Gold (Worcester+Mixergy)",price});
  const refCombi=baseCalc({usage:state.u,mains:state.m,layout:state.l,system:"Combi Premium",price});
  const bestEnergy=Math.min(refGold.energy,refCombi.energy);
  const bestCost=Math.min(refGold.cost,refCombi.cost);
  const W=state.w;
  const Ue=invUtility(base.energy,bestEnergy);
  const Up=invUtility(base.cost,bestCost);
  const layoutPenalty=state.l==="Central"?0:state.l==="Typical"?6:12;
  const S=PRE.system[state.s];
  const Uc=clamp((S.C||75)-layoutPenalty,10,100);
  const Uf=clamp(S.F||60,10,100);
  const Um=clamp(S.M||70,10,100);
  const totalW=W.e+W.c+W.C+W.F+W.M;
  const score=(W.e*Ue+W.c*Up+W.C*Uc+W.F*Uf+W.M*Um)/Math.max(totalW,1);
  return {
    totals:base,
    utilities:{
      energy:Math.round(Ue),
      cost:Math.round(Up),
      comfort:Math.round(Uc),
      future:Math.round(Uf),
      maintenance:Math.round(Um),
      score:Math.round(score)
    }
  };
}

const $=sel=>document.querySelector(sel);

function getState(){
  return {
    u:$('#usage').value,
    m:$('#mains').value,
    l:$('#layout').value,
    s:$('#system').value,
    pgas:toNumber($('#gas').value,PRE.price.gas),
    pw:toNumber($('#water').value,PRE.price.water),
    w:{
      e:toInteger($('#wE').value,PRE.weights.energy),
      c:toInteger($('#wCost').value,PRE.weights.cost),
      C:toInteger($('#wC').value,PRE.weights.comfort),
      F:toInteger($('#wF').value,PRE.weights.future),
      M:toInteger($('#wM').value,PRE.weights.maintenance)
    }
  };
}

function updateOutputs(state,computed){
  const tot=computed.totals;
  $('#kwhDay').textContent=round(tot.energy,3);
  $('#kwhYear').textContent=`â‰ˆ ${Math.round(tot.energy*365)} kWh/yr`;
  $('#costDay').textContent=tot.cost.toFixed(2);
  $('#costYear').textContent=`â‰ˆ Â£${Math.round(tot.cost*365)} /yr`;
  $('#wasteL').textContent=tot.waitLitres.toFixed(1);
  $('#score').textContent=computed.utilities.score;
  $('#uE').textContent=computed.utilities.energy;
  $('#uP').textContent=computed.utilities.cost;
  $('#uC').textContent=computed.utilities.comfort;
  $('#uF').textContent=computed.utilities.future;
  $('#uM').textContent=computed.utilities.maintenance;
  $('#eUse').textContent=round(tot.breakdown.Eu,3);
  $('#eWait').textContent=round(tot.breakdown.Ew,3);
  $('#standby').textContent=round(tot.breakdown.standby,3);
  $('#eta').textContent=round(tot.breakdown.eta,3);
  $('#starts').textContent=tot.breakdown.starts;
  $('#echo').textContent=`${state.u} â€¢ ${state.m} â€¢ ${state.l} â€¢ ${state.s}`;
}

function refresh(){
  const s=getState();
  const c=compute(s);
  updateOutputs(s,c);
  return {state:s,computed:c};
}

function setSlider(id,val){
  const el=$(`#${id}`);
  if(!el) return;
  el.value=val;
  const out=$(`#${id}Val`);
  if(out) out.textContent=val;
}

function applyState(s){
  $('#usage').value=s.u;
  $('#mains').value=s.m;
  $('#layout').value=s.l;
  $('#system').value=s.s;
  $('#gas').value=s.pgas;
  $('#water').value=s.pw;
  setSlider('wE',s.w.e);
  setSlider('wCost',s.w.c);
  setSlider('wC',s.w.C);
  setSlider('wF',s.w.F);
  setSlider('wM',s.w.M);
  refresh();
}

function preset(values){
  const current=getState();
  applyState({
    ...current,
    w:{
      e:values.wE ?? current.w.e,
      c:values.wCost ?? current.w.c,
      C:values.wC ?? current.w.C,
      F:values.wF ?? current.w.F,
      M:values.wM ?? current.w.M
    }
  });
}

function toParams(state){
  const p=new URLSearchParams();
  p.set('u',state.u);
  p.set('m',state.m);
  p.set('l',state.l);
  p.set('s',state.s);
  p.set('g',state.pgas);
  p.set('w',state.pw);
  p.set('we',state.w.e);
  p.set('wc',state.w.c);
  p.set('c',state.w.C);
  p.set('f',state.w.F);
  p.set('mm',state.w.M);
  return p;
}

function fromParams(){
  if(!location.hash) return null;
  const q=new URLSearchParams(location.hash.slice(1));
  if(!q.has('u')) return null;
  return {
    u:q.get('u')||$('#usage').value,
    m:q.get('m')||$('#mains').value,
    l:q.get('l')||$('#layout').value,
    s:q.get('s')||$('#system').value,
    pgas:toNumber(q.get('g'),toNumber($('#gas').value,PRE.price.gas)),
    pw:toNumber(q.get('w'),toNumber($('#water').value,PRE.price.water)),
    w:{
      e:toInteger(q.get('we'),toInteger($('#wE').value,PRE.weights.energy)),
      c:toInteger(q.get('wc'),toInteger($('#wCost').value,PRE.weights.cost)),
      C:toInteger(q.get('c'),toInteger($('#wC').value,PRE.weights.comfort)),
      F:toInteger(q.get('f'),toInteger($('#wF').value,PRE.weights.future)),
      M:toInteger(q.get('mm'),toInteger($('#wM').value,PRE.weights.maintenance))
    }
  };
}

async function copyText(txt){
  try{
    await navigator.clipboard.writeText(txt);
  }catch(err){
    console.error('Copy failed',err);
  }
}

$('#presetBudget').addEventListener('click',()=>preset({wE:3,wCost:8,wC:2,wF:2,wM:2}));
$('#presetComfort').addEventListener('click',()=>preset({wE:3,wCost:3,wC:8,wF:3,wM:3}));
$('#presetFuture').addEventListener('click',()=>preset({wE:5,wCost:4,wC:3,wF:8,wM:2}));
$('#presetReset').addEventListener('click',()=>preset({wE:3,wCost:5,wC:4,wF:4,wM:2}));
$('#copy').addEventListener('click',()=>{
  const {computed}=refresh();
  copyText(JSON.stringify({
    energy_kWh_day:round(computed.totals.energy,3),
    cost_per_day:round(computed.totals.cost,2),
    wait_litres_day:round(computed.totals.waitLitres,1),
    breakdown:{
      useful_kWh_day:round(computed.totals.breakdown.Eu,3),
      waiting_kWh_day:round(computed.totals.breakdown.Ew,3),
      standby_kWh_day:round(computed.totals.breakdown.standby,3),
      eta:round(computed.totals.breakdown.eta,3),
      starts:computed.totals.breakdown.starts
    },
    utilities:computed.utilities
  },null,2));
});
$('#link').addEventListener('click',()=>{
  const {state}=refresh();
  const params=toParams(state);
  const url=`${location.origin}${location.pathname}#${params.toString()}`;
  history.replaceState(null,'',`#${params.toString()}`);
  copyText(url);
});

for(const input of document.querySelectorAll('input,select')){
  input.addEventListener('input',evt=>{
    if(evt.target.type==='range'){
      const out=$(`#${evt.target.id}Val`);
      if(out) out.textContent=evt.target.value;
    }
    refresh();
  });
}

const initial=fromParams();
if(initial){
  applyState(initial);
}else{
  refresh();
}
</script>
</body>
</html>
