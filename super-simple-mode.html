<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#05070a" />
  <title>Depot Notes ‚Äì Super Simple Mode</title>
  <link rel="manifest" href="manifest.webmanifest" />
  <style>
    :root {
      --bg: #05070a;
      --panel: rgba(18, 24, 32, 0.92);
      --accent: #4aa3ff;
      --border: #1d2737;
      --ink: #f3f7ff;
      --muted: #8da2c2;
    }
    * {
      box-sizing: border-box;
    }
    html, body {
      height: 100%;
    }
    body {
      margin: 0;
      background: radial-gradient(circle at 0% -10%, rgba(74, 163, 255, 0.18), transparent 55%), var(--bg);
      color: var(--ink);
      font: 16px/1.5 "Inter", ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    header {
      padding: 28px 20px 16px;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
    }
    header h1 {
      margin: 0 0 6px;
      font-size: 28px;
    }
    header p {
      margin: 0;
      color: var(--muted);
      font-size: 15px;
    }
    .home-link {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid rgba(74, 163, 255, 0.35);
      background: rgba(74, 163, 255, 0.12);
      color: var(--accent);
      font-weight: 600;
      text-decoration: none;
      transition: background 0.2s ease, color 0.2s ease;
    }
    .home-link:hover {
      background: var(--accent);
      color: #021427;
    }
    main {
      flex: 1;
      display: grid;
      gap: 22px;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      padding: 0 20px 32px;
      width: min(1200px, 100%);
      margin: 0 auto;
    }
    .panel {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 20px;
      backdrop-filter: blur(8px);
      box-shadow: 0 18px 36px rgba(5, 9, 15, 0.5);
      display: flex;
      flex-direction: column;
      gap: 18px;
    }
    .section-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-height: calc(100vh - 200px);
      overflow: auto;
      padding-right: 4px;
    }
    details.section {
      background: rgba(9, 14, 21, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.06);
      border-radius: 14px;
      padding: 0 16px 10px;
      transition: border-color 0.2s ease;
    }
    details.section[open] {
      border-color: rgba(74, 163, 255, 0.45);
      box-shadow: inset 0 0 0 1px rgba(74, 163, 255, 0.15);
    }
    details.section summary {
      cursor: pointer;
      list-style: none;
      padding: 14px 0;
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 12px;
      font-weight: 600;
    }
    details.section summary::-webkit-details-marker {
      display: none;
    }
    .count-badge {
      background: rgba(74, 163, 255, 0.15);
      border-radius: 999px;
      padding: 2px 10px;
      font-size: 12px;
      color: var(--accent);
      border: 1px solid rgba(74, 163, 255, 0.35);
    }
    .options {
      display: grid;
      gap: 8px;
      padding-bottom: 6px;
    }
    .option {
      display: flex;
      gap: 10px;
      align-items: flex-start;
      background: rgba(13, 18, 28, 0.65);
      border-radius: 10px;
      padding: 8px 10px;
      border: 1px solid transparent;
      transition: border-color 0.2s ease, background 0.2s ease;
    }
    .option:hover {
      border-color: rgba(74, 163, 255, 0.25);
      background: rgba(17, 24, 36, 0.75);
    }
    .option input[type="checkbox"] {
      margin-top: 4px;
      transform: scale(1.1);
    }
    .option span {
      font-size: 14px;
      color: var(--muted);
    }
    .outputs {
      display: grid;
      gap: 16px;
    }
    .output {
      display: flex;
      flex-direction: column;
      gap: 10px;
      background: rgba(9, 14, 21, 0.65);
      border: 1px solid rgba(255, 255, 255, 0.06);
      border-radius: 16px;
      padding: 14px;
    }
    .output h3 {
      margin: 0;
      font-size: 16px;
    }
    .output textarea {
      width: 100%;
      min-height: 90px;
      border-radius: 12px;
      border: 1px solid rgba(74, 163, 255, 0.25);
      background: rgba(7, 10, 16, 0.85);
      color: var(--ink);
      padding: 12px;
      font: inherit;
      resize: vertical;
    }
    .copy-button {
      align-self: flex-start;
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid rgba(74, 163, 255, 0.35);
      background: rgba(74, 163, 255, 0.15);
      color: var(--accent);
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s ease, color 0.2s ease;
    }
    .copy-button:hover {
      background: var(--accent);
      color: #021427;
    }
    footer {
      text-align: center;
      color: var(--muted);
      padding: 18px 20px 28px;
      font-size: 14px;
    }
    @media (max-width: 768px) {
      main {
        grid-template-columns: 1fr;
      }
      .section-list {
        max-height: none;
      }
    }
  </style>
</head>
<body>
  <header>
    <a class="home-link" href="welcome.html">üè† Back to welcome</a>
    <h1>Super Simple Mode</h1>
    <p>Tick the relevant notes and copy everything you need in one go.</p>
  </header>
  <main>
    <section class="panel">
      <h2 style="margin:0">Sections</h2>
      <div id="sectionList" class="section-list" aria-live="polite"></div>
    </section>
    <section class="panel">
      <h2 style="margin:0">Copy boxes</h2>
      <p style="margin:0;color:var(--muted);font-size:14px">Selections appear below automatically. Use the copy buttons to paste into notes.</p>
      <div id="outputs" class="outputs" aria-live="polite"></div>
    </section>
  </main>
  <footer>Depot Notes works offline once installed. Updates arrive automatically.</footer>

  <script>
    const sectionList = document.getElementById('sectionList');
    const outputsContainer = document.getElementById('outputs');

    let sections = [];

    function slugify(title) {
      return title.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-+|-+$/g, '') || 'section';
    }

    function parseSections(text) {
      const result = [];
      let current = null;
      let currentGroup = '';

      text.split(/\r?\n/).forEach((rawLine) => {
        const line = rawLine.trim();
        if (!line) return;
        if (/^\[(.+)\]$/.test(line)) {
          const title = RegExp.$1.trim();
          current = { id: slugify(title), title, items: [] };
          result.push(current);
          currentGroup = '';
          return;
        }
        if (line.startsWith('|')) {
          currentGroup = line.slice(1).trim();
          return;
        }
        if (!current) return;

        if (!line.includes('|')) {
          current.items.push({ code: '', category: currentGroup, description: line });
          return;
        }

        const parts = line.split('|').map((part) => part.trim());
        if (!parts.length) return;

        const code = parts.shift();
        let category = '';
        let description = '';

        if (parts.length > 1) {
          category = parts.shift() || '';
          description = parts.join(' | ');
        } else if (parts.length === 1) {
          description = parts[0];
        }

        if (!category && currentGroup) {
          category = currentGroup;
        }

        const item = {
          code: code || '',
          category: category || '',
          description: description || '',
        };

        if (item.code || item.description) {
          current.items.push(item);
        }
      });

      return result.filter((section) => section.items.length > 0);
    }

    async function loadSections() {
      sectionList.innerHTML = '<p style="margin:0;color:var(--muted)">Loading Options.txt‚Ä¶</p>';
      outputsContainer.innerHTML = '';
      try {
        const res = await fetch('./Options.txt', { cache: 'no-store' });
        if (!res.ok) throw new Error('Options.txt not found');
        const text = await res.text();
        sections = parseSections(text);
        if (!sections.length) {
          sectionList.innerHTML = '<p style="margin:0;color:var(--muted)">Options.txt is empty.</p>';
          outputsContainer.innerHTML = '';
          return;
        }
        renderSections();
      } catch (err) {
        console.error('Failed to load Options.txt', err);
        sections = [];
        sectionList.innerHTML = '<p style="margin:0;color:var(--muted)">Unable to load Options.txt. Please refresh.</p>';
      }
    }

    function renderSections() {
      sectionList.innerHTML = '';
      outputsContainer.innerHTML = '';
      if (!sections.length) return;

      sections.forEach((section) => {
        createSection(section);
        createOutput(section);
      });
      updateOutputs();
    }

    const formatItem = (code, category, description) => {
      return [code, category, description].filter(Boolean).join(' | ');
    };

    const createSection = (section) => {
      const details = document.createElement('details');
      details.className = 'section';
      details.dataset.section = section.id;
      details.dataset.label = section.title;

      const summary = document.createElement('summary');
      summary.innerHTML = `<span>${section.title}</span><span class="count-badge" data-count="${section.id}">0 selected</span>`;
      details.appendChild(summary);

      const options = document.createElement('div');
      options.className = 'options';

      section.items.forEach(({ code, category, description }) => {
        const label = document.createElement('label');
        label.className = 'option';

        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.value = formatItem(code, category, description);
        checkbox.dataset.section = section.id;
        checkbox.dataset.code = code || '';

        const text = document.createElement('div');
        const strong = document.createElement('strong');
        strong.textContent = code || '‚Ä¢';
        const span = document.createElement('span');
        const descriptionParts = [category, description].filter(Boolean).join(' | ');
        span.textContent = descriptionParts;

        text.appendChild(strong);
        text.appendChild(document.createElement('br'));
        text.appendChild(span);

        label.appendChild(checkbox);
        label.appendChild(text);
        options.appendChild(label);
      });

      details.appendChild(options);
      sectionList.appendChild(details);
    };

    const createOutput = (section) => {
      const container = document.createElement('div');
      container.className = 'output';
      container.dataset.section = section.id;

      const heading = document.createElement('h3');
      heading.textContent = section.title;

      const textarea = document.createElement('textarea');
      textarea.readOnly = true;
      textarea.placeholder = 'Selections appear here...';

      const button = document.createElement('button');
      button.type = 'button';
      button.className = 'copy-button';
      button.dataset.section = section.id;
      button.textContent = 'Copy';

      button.addEventListener('click', async () => {
        textarea.select();
        textarea.setSelectionRange(0, textarea.value.length);
        try {
          await navigator.clipboard.writeText(textarea.value);
          button.textContent = 'Copied!';
          setTimeout(() => (button.textContent = 'Copy'), 1500);
        } catch (err) {
          document.execCommand('copy');
          button.textContent = 'Copied!';
          setTimeout(() => (button.textContent = 'Copy'), 1500);
        }
      });

      container.appendChild(heading);
      container.appendChild(textarea);
      container.appendChild(button);
      outputsContainer.appendChild(container);
    };

    const updateOutputs = () => {
      if (!sections.length) return;

      sections.forEach((section) => {
        const checkboxes = sectionList.querySelectorAll(`input[type="checkbox"][data-section="${section.id}"]`);
        const selected = Array.from(checkboxes)
          .filter((input) => input.checked)
          .map((input) => input.value);

        const output = outputsContainer.querySelector(`.output[data-section="${section.id}"] textarea`);
        if (output) {
          output.value = selected.join('\n');
        }

        const countBadge = sectionList.querySelector(`.count-badge[data-count="${section.id}"]`);
        if (countBadge) {
          countBadge.textContent = `${selected.length} selected`;
        }
      });
    };

    sectionList.addEventListener('change', (event) => {
      if (event.target.matches('input[type="checkbox"]')) {
        updateOutputs();
      }
    });

    loadSections();

    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js').catch((err) => {
          console.error('Service worker registration failed:', err);
        });
      });
    }
  </script>
</body>
</html>
